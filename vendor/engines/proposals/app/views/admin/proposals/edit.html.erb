<%= render :partial => '/shared/admin/error_messages', :locals => {
  :object => @proposal,
  :include_object_name => true
} %>

<div id='actions'>
  <h2><%= t('.details')%></h2>
  <p>
    <strong><%= t('.age') %>:</strong> <%= time_ago_in_words(@proposal.created_at) %>
  </p>
  <h2><%= t('.actions') %></h2>
  <ul>
    <li>
      <%= link_to t('.back_to_all_proposals'), {:action => 'index'}, :class => "back_icon" %>
    </li>
  </ul>
</div>


<div id='records'>
  <h2><%= t('.proposal') %></h2>

  <table id="inquiry">
    <tbody>

      <% [:title, :abstract, :av_requirement, :video_approval, 
        :talk_type, :track, :talk_length].each do |field| %>

          <tr>
            <td>
              <strong><%= t(".#{ field }") -%></strong>
            </td>
            <td>
              <%= @proposal.talk.send(field) -%>
            </td>
          </tr>

        <% end %>

        <% @proposal.talk.speakers.each do |speaker| %>

          <tr>
            <td>
              <strong><%= t('.by') -%></strong>
            </td>
            <td>
              <%= "#{speaker.first_name} #{speaker.last_name}" -%>
            </td>
          </tr>
          <tr>
            <td>
              <strong><%= t('.bio') -%></strong>
            </td>
            <td>
              <%= speaker.bio -%>
            </td>
          </tr>
        <% end %>

        <tr>
          <td>
            <strong><%= t('.status') -%></strong>
          </td>

          <td>
            <%= @proposal.status -%>
          </td> 
        </tr>

      <tr>
        <td>
          <strong><%= t('.comments') -%></strong>
        </td>

        <td>
          <% @proposal.comments_by_user(current_user).each do |comment| %>
          <pre><%= comment.comment.to_s %> </pre>
          <br/>
          <% end %>
        </td> 
        </tr>

      </tbody>
    </table>

    <% if current_user.has_role? :organizer -%>
      <h3><%= t('.other_ratings') -%>:</h3>
      <% for rater in @proposal.raters('appeal') -%>
        <%= render :partial => 'reviews', :locals => { :rater => rater, :proposal => @proposal } unless rater == current_user %>
      <% end %>
      <% if @proposal.status != 'accepted' %>
      <%= button_to "Approve Talk", { :action => "approve_proposal",
      :proposal => @proposal}%>
      <% else %>
      <%= button_to "Reject Talk", { :action => "reject_proposal",
      :proposal => @proposal} %>
      <% end %>
    <% end %>

    <% if current_user.has_role? :reviewer -%>
      <h3><%= t('.your_rating') -%>:</h3>
      <%= render :partial => 'rating', :locals => { :proposal => @proposal } %>
      <h3><%= t('.add_comment') -%>:</h3>
      <%= render :partial => 'add_comment', :locals => { :proposal => @proposal } %>
    <% end -%>
</div>  

